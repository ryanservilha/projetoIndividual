<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>Dashboard</title>
</head>

<body onload="obterDados()">
    <div class="container">
        <div class="logo">
            <a href="index.html">
                <h1>C<img src="./assets/imgs/logo.png">FFEEL</h1>
            </a>
        </div>
        <div class="titulo">
            <h2>Métricas Coffeel</h2>
        </div>

        <div class="containerKpisGraficos">
            <div class="kpis">
                <div class="card" id="mediaIdade">
                    <h2>Média da Idade dos Consumidores</h2>
                    <div class="resposta" id="idadeMedia"></div>
                </div>

                <div class="card">
                    <h2>Tipo de Café mais consumido</h2>
                    <div class="resposta" id="cafeMaisConsumido"></div>
                </div>

                <div class="card">
                    <h2>Qtd de envios do questionário</h2>
                    <div class="resposta" id="qtdEnvios"></div>
                </div>

                <div class="card" id="mediaAcertosCard">
                    <h2>Média de Acertos do Quiz</h2>
                    <div class="resposta" id="mediaAcertos"></div>
                </div>
            </div>
            <div class="graficos">
                <div class="graficoEsquerdo">
                    <h2>QTD de Respostas ao questionário na semana</h2>
                    <canvas id="myChartCanvas"></canvas>
                </div>
                <div class="graficosDireito">
                    <div class="graficoCafeConsumido">
                        <h2>Ambiente em que o café é consumido</h2>
                        <canvas id="graficoCafeConsumido"></canvas>
                    </div>
                    <div class="graficosPizza">
                        <div class="graficoCafeEssencial">
                            <h2>O café é essencial na sua vida?</h2>
                            <canvas id="graficoCafeEssencial"></canvas>
                        </div>
                        <div class="temperaturaCafe">
                            <h2>Temperatura Café</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>


    function obterDados() {
        var vt_idade = [];

        fetch(`/dashboard/idadeMedia`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                    vt_idade = resposta;
                    idadeMedia.innerHTML = `${vt_idade[0].IdadeMedia}`;
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/cafeMaisConsumido`, { cache: 'no-store' }).then(function (response) {
            var vt_cafeConsumido = [];

            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                    vt_cafeConsumido = resposta;
                    cafeMaisConsumido.innerHTML = `${vt_cafeConsumido[0].CafeMaisConsumido}`;
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/qtdEnvios`, { cache: 'no-store' }).then(function (response) {
            var vt_qtdEnvios = [];

            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                    vt_qtdEnvios = resposta;
                    qtdEnvios.innerHTML = `${vt_qtdEnvios[0].QtdEnvios}`;
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/mediaAcertos`, { cache: 'no-store' }).then(function (response) {
            var vt_media = [];

            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);


                    vt_media = resposta;
                    mediaAcertos.innerHTML = `${vt_media[0].MediaPontos}`;
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/graficoSemana`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    graficoSemana(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/graficoAmbiente`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    graficoAmbiente(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        fetch(`/dashboard/graficoEssencial`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    graficoEssencial(resposta);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function graficoSemana(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Acessos',
                data: [],
                fill: false,
                backgroundColor: '#6a3604',
                borderColor: '#6a3604',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.Dia);
            dados.datasets[0].data.push(registro.Acessos);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')
        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'line',
            data: dados,
            options: {
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChartCanvas`),
            config
        );

    }

    function graficoAmbiente(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Respostas',
                data: [],
                fill: false,
                backgroundColor: '#6a3604',
                borderColor: '#6a3604',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.Ambiente);
            dados.datasets[0].data.push(registro.QtdAmbiente);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')
        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        title: {
                            display: true,
                        },
                        beginAtZero: true,
                        grid: {
                            display: false
                        }
                    },
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`graficoCafeConsumido`),
            config
        );
    }

    function graficoEssencial(resposta) {

        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];

        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: labels,
            datasets: [{
                label: 'Respostas',
                data: [],
                fill: false,
                backgroundColor: ['#6a3604', 'black'],
                borderColor: '#6a3604',
                tension: 0.1
            }]
        };

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            labels.push(registro.Descricao);
            dados.datasets[0].data.push(registro.Quantidade);
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')
        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'pie',
            data: dados,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true
                    }
                }
            }
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`graficoCafeEssencial`),
            config
        );
    }


</script>